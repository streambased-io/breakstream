  directstream:
    image: local/directstream:latest
    #image: streambased/directstream:overlay-demo
    hostname: directstream
    container_name: directstream
    platform: linux/amd64
    restart: on-failure
    ports:
      - 11000:11000
      - 11001:11001
    environment:
      - AWS_REGION=us-east-1
      - ISK_PORT=11000
      - ISK_CATALOG_PORT=11001
      - ISK_TEST_EXECUTION_MODE=docker
      - ISK_EXTERNAL_HOSTNAME=directstream
      - ISK_CONFIG_SERVICE_URL=http://unused
      - ISK_CACHE_OFFSET_REANGES_EXPIRATION_SECONDS=10
      - ISK_CONFIG_PROVIDER=properties
      - ISK_CONFIG_SOURCES=dummyapi
      - ISK_CONFIG_SOURCE_DUMMYAPI_S3KEY=dummyapi
      - ISK_CONFIG_SOURCE_DUMMYAPI_S3SECRET=dummysecret
      - ISK_CONFIG_SOURCE_DUMMYAPI_BOOTSTRAP_SERVERS=kafka1:9092
      - ISK_CONFIG_SOURCE_DUMMYAPI_SCHEMA_REGISTRY_SCHEMA_REGISTRY_URL=http://schema-registry:8081/
      - ISK_COLDSET_CLIENT_URI=http://rest:8181/
      - ISK_COLDSET_CLIENT_REST_SIGV4-ENABLED=true
      - ISK_COLDSET_CLIENT_REST_ACCESS-KEY-ID=admin
      - ISK_COLDSET_CLIENT_REST_SECRET-ACCESS-KEY=password
      - ISK_COLDSET_CLIENT_REST_SIGNING-REGION=us-east-1
      - ISK_COLDSET_CLIENT_REST-METRICS-REPORTING-ENABLED=false
      - ISK_COLDSET_CLIENT_WAREHOUSE=s3://
      - ISK_COLDSET_CLIENT_IO-IMPL=org.apache.iceberg.aws.s3.S3FileIO
      - ISK_COLDSET_CLIENT_S3_ENDPOINT=http://minio:9000/
      - ISK_COLDSET_CLIENT_S3_PATH-STYLE-ACCESS=true
      - ISK_COLDSET_CLIENT_S3_ACCESS-KEY-ID=admin
      - ISK_COLDSET_CLIENT_S3_SECRET-ACCESS-KEY=password
      - ISK_COLDSET_CLIENT_S3_REGION=us-east-1

  hyperstream:
    #image: local/hyperstream:latest
    image: streambased/hyperstream:latest
    container_name: hyperstream
    platform: linux/amd64
    ports:
      - 9088:9088
    environment:
      - SPARK_CONNECT_URL=sc://spark-iceberg:15002
      - COLD_SET_SCHEMA=direct.coldset
      - HOT_SET_SCHEMA=isk.hotset
      - UNIFIED_SET_SCHEMA=isk.merged

  streambased-ui:
    image: streambased/ui:overlay-demo
    container_name: streambased-ui
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DEMO_MODE=true
      - AUTH_SECRET=""
      - HYPERSTREAM_BASE_URL=http://hyperstream:9088
      - OPENAI_API_KEY=ignored
      - OPEN_AI_MODEL=gpt-4o-mini

  ksi:
    #image: local/ksi:latest
    image: streambased/ksi:latest
    hostname: ksi
    container_name: ksi
    depends_on:
      schema-registry:
        condition: service_healthy
      rest:
        condition: service_started
    ports:
      - "9192:9192"
    environment:
      - KROXYLICIOUS_CONFIG=/opt/kroxylicious/config.yaml
      - KROXYLICIOUS_APP_LOG_LEVEL=TRACE
      - KROXYLICIOUS_LOGGING_OPTIONS=-Dlog4j2.configurationFile=/opt/kroxylicious/config/log4j2.yaml ${KROXYLICIOUS_JAVA_OPTS}
      - KSI_BOOTSTRAP_SERVERS=kafka1:9092
      - KSI_GATEWAY_BOOTSTRAP_ADDRESS=ksi:9192
      - KSI_COLD_STORAGE_TYPE=spark-connect
      - KSI_MAX_COLD_STORAGE_RECORDS_PER_FETCH=1000
      - KSI_COLD_STORAGE_TIMEOUT_MS=30000
      - KSI_ALWAYS_RETURN_MINUS_ONE_START_OFFSET=true
      - KSI_ICEBERG_NAMESPACE=coldset
      - KSI_SPARK_CONNECT_URL=sc://spark-iceberg:15002
      - KSI_SPARK_CATALOG_NAME=direct
      - KSI_OFFSET_RANGE_CACHE_TTL_MS=300000
      - KSI_OFFSET_RANGE_CACHE_REFRESH_MS=60000
      - KSI_SCHEMA_REGISTRY_URL=http://schema-registry:8081
    command: [ "-c", "/opt/kroxylicious/config.yaml" ]
